<!DOCTYPE html>
<html>
<head>
    <title>Springs demo - p2.js physics engine</title>
    <script src="../build/p2.js"></script>
    <script src="../build/p2.renderer.js"></script>
    <link href="css/demo.css" rel="stylesheet"/>
    <meta name="description" content="How to build a spring structure.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
    <script>

        // Create demo application
        var app = new p2.WebGLRenderer(function(){

            var world = new p2.World({
                gravity : [0,-5]
            });

            this.setWorld(world);

            world.solver.tolerance = 0.001;

            var bodies = [];
            var N=5,
                M=10,
                timeStep = 1/60,
                k=1000,
                d=10,
                l=0.35,
                m=1,
                lastBody;

            for (var i = 0; i < N; i++) {

                // Create capsules connected with angular spring
                var capsuleShape = new p2.Capsule(1, 0.2);
                var capsuleBody = new p2.Body({
                    mass: i === 0 ? 0 : 1,
                    position : [0, i],
                    angle: Math.PI / 2
                });
                capsuleBody.addShape(capsuleShape);
                world.addBody(capsuleBody);

                if(lastBody){
                    var rotationalSpring = new p2.RotationalSpring(capsuleBody, lastBody, {
                        stiffness : (N - i) * 200 + 100,
                        damping: 0.1
                    });
                    world.addSpring(rotationalSpring);
                    var revolute = new p2.RevoluteConstraint(capsuleBody, lastBody, {
                        localPivotA: [-0.5, 0],
                        localPivotB: [0.5, 0],
                        collideConnected:false
                    });
                    world.addConstraint(revolute);
                }

                lastBody = capsuleBody;
            }

            this.frame(0,2,8,8);
        });

    </script>
</bodyBody>
</html>
